# Migration from Supabase to SQLite + PWA

This document describes the migration from Supabase to a local SQLite-based solution with PWA capabilities.

## What Changed

### ✅ Database Layer
- **Removed**: Supabase PostgreSQL database
- **Added**: SQLite using `sql.js` (runs in browser via WebAssembly)
- **Storage**: IndexedDB for persistent SQLite database storage
- **Location**: `src/lib/database.ts`

### ✅ Authentication
- **Removed**: Supabase Auth
- **Added**: Local authentication with bcrypt password hashing
- **Storage**: SQLite database for user credentials
- **Sessions**: localStorage for session management
- **Location**: `src/lib/auth.ts` and `src/contexts/AuthContext.tsx`

### ✅ File Storage
- **Removed**: Supabase Storage
- **Added**: IndexedDB for audio file storage
- **Location**: `src/lib/storage.ts`

### ✅ Transcription Service
- **Removed**: Supabase Edge Functions
- **Added**: Direct OpenAI API integration from client
- **Location**: `src/lib/transcription.ts`
- **Note**: Requires `VITE_OPENAI_API_KEY` environment variable

### ✅ Progressive Web App (PWA)
- **Added**: Full PWA support with:
  - Web App Manifest
  - Service Worker (auto-generated by vite-plugin-pwa)
  - Offline support
  - Install prompts
  - Caching strategies
- **Location**: `vite.config.ts`, `public/manifest.json`, `index.html`

## New Dependencies

- `sql.js` - SQLite compiled to WebAssembly
- `bcryptjs` - Password hashing
- `vite-plugin-pwa` - PWA support for Vite
- `@types/bcryptjs` - TypeScript types

## Removed Dependencies

- `@supabase/supabase-js` - No longer needed

## Environment Variables

Create a `.env` file in the project root:

```env
VITE_OPENAI_API_KEY=your_openai_api_key_here
```

Get your API key from: https://platform.openai.com/api-keys

## Features

### ✅ Maintained Features
- User sign up and sign in
- Voice recording with pause/resume
- AI transcription (OpenAI Whisper)
- Notes storage and retrieval
- Search functionality
- Note deletion
- User session management

### ✅ New Features (PWA)
- Installable on mobile and desktop
- Offline support (with service worker caching)
- App-like experience (standalone display mode)
- App shortcuts for quick access

## Architecture

### Database Structure
- **SQLite Database** stored in IndexedDB
- **Tables**:
  - `users` - User accounts with hashed passwords
  - `notes` - Voice notes with metadata
- **Persistence**: Automatic save to IndexedDB after each operation

### Storage
- **Audio Files**: Stored as Blobs in IndexedDB
- **Database**: SQLite binary format in IndexedDB
- All data stays local to the user's device

### Authentication Flow
1. User signs up → Password hashed with bcrypt → Stored in SQLite
2. User signs in → Password verified → Session stored in localStorage
3. Protected routes check session via AuthContext

## Mobile Support

- **Responsive Design**: Already implemented with Tailwind CSS
- **Touch-Friendly**: UI components are touch-optimized
- **PWA Install**: Can be installed on iOS and Android
- **Offline Capable**: Works offline after initial load

## Testing the Migration

1. **Clear Browser Data**: Since this is a new database system, you may want to clear localStorage and IndexedDB
2. **Sign Up**: Create a new account
3. **Record**: Test voice recording and transcription
4. **Install PWA**: Test installing on mobile/desktop
5. **Offline**: Test functionality while offline

## Known Considerations

1. **OpenAI API Key**: Must be set in environment variable (exposed in client bundle)
   - For production, consider using a backend proxy for API key security
2. **Data Persistence**: All data is local to the device
   - No cloud sync (this is intentional for privacy)
   - Users can export data by accessing IndexedDB
3. **Browser Compatibility**: 
   - Requires modern browser with IndexedDB support
   - SQLite via sql.js works in all modern browsers
4. **Storage Limits**: 
   - IndexedDB has limits (usually 50% of disk space)
   - Audio files are stored locally, so storage can fill up

## Deployment

When building for production:

```bash
npm run build
```

The build output includes:
- Service worker for offline support
- PWA manifest
- All assets optimized for production

Serve the `dist` folder with any static file server. The app works as a PWA!

## Future Enhancements

Potential improvements:
- Data export/import functionality
- Backend proxy for OpenAI API (to hide API key)
- Cloud sync option (optional)
- Better offline transcription queue
- Database migration tools



